{
  "project": "ThumbCode",
  "branchName": "ralph/expo-to-capacitor",
  "description": "Full migration from Expo/React Native to React + Capacitor. Replace all RN components with web HTML, expo-router with React Router, expo-* plugins with Capacitor plugins, Metro with Vite, NativeWind with standard Tailwind CSS, jest-expo with Vitest, and EAS CI/CD with Capacitor builds.",
  "workstreams": {
    "A": "build-foundation",
    "B": "ui-primitives",
    "C": "screen-migration",
    "D": "plugin-migration",
    "E": "cleanup-testing",
    "F": "cicd"
  },
  "userStories": [
    {
      "id": "US-201",
      "workstream": "A",
      "title": "Replace Metro/Babel with Vite + React",
      "description": "As a developer, I need the build tooling changed from Metro/babel-preset-expo to Vite so the app builds as a standard React web app.",
      "acceptanceCriteria": [
        "Install vite, @vitejs/plugin-react, vite-tsconfig-paths as devDependencies",
        "Create vite.config.ts with React plugin, tsconfig paths, and resolve aliases matching current @/* paths",
        "Create src/main.tsx entry point that renders <App /> into document.getElementById('root')",
        "Create index.html at project root with <div id='root'></div> and script tag pointing to src/main.tsx",
        "Delete metro.config.js",
        "Delete babel.config.js and babel.config.jest.js",
        "Update package.json scripts: dev → vite, build → vite build, preview → vite preview",
        "Remove 'main': 'expo-router/entry' from package.json",
        "Update tsconfig.json: remove 'extends': 'expo/tsconfig.base', set target/module/jsx appropriately for Vite",
        "pnpm run build succeeds with zero errors",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-202",
      "workstream": "A",
      "title": "Configure standard Tailwind CSS (remove NativeWind)",
      "description": "As a developer, I need NativeWind replaced with standard Tailwind CSS since we're now a web app, keeping all existing design tokens.",
      "acceptanceCriteria": [
        "Install tailwindcss, postcss, autoprefixer as devDependencies",
        "Create postcss.config.js with tailwindcss and autoprefixer plugins",
        "Update tailwind.config.ts: remove nativewind preset, update content paths for src/**/*.tsx",
        "Keep ALL existing color tokens (coral, teal, gold, charcoal, surface), font families, organic border-radius, and organic shadows",
        "Update global.css: add @tailwind base/components/utilities directives, remove NativeWind-specific @layer utilities",
        "Import global.css in src/main.tsx",
        "Remove nativewind and react-native-css-interop from dependencies",
        "Remove withNativeWind from any config",
        "Verify tailwind classes compile correctly in build output",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-203",
      "workstream": "A",
      "title": "Set up React Router matching current route structure",
      "description": "As a developer, I need React Router configured to match the current expo-router route hierarchy so navigation works identically.",
      "acceptanceCriteria": [
        "Install react-router-dom@^7",
        "Create src/router.tsx with route config matching current structure: tabs (/, /agents, /projects, /settings, /chat), onboarding (/welcome, /github-auth, /api-keys, /create-project, /complete), detail (/agent/:id, /project/:id), settings sub-routes (/settings/agents, /settings/credentials, /settings/editor), 404 catch-all",
        "Create src/layouts/TabLayout.tsx with bottom tab navigation matching current (tabs)/_layout.tsx",
        "Create src/layouts/OnboardingLayout.tsx with stack-like navigation",
        "Create src/layouts/RootLayout.tsx that conditionally shows onboarding vs main app",
        "Wire router into src/main.tsx via BrowserRouter",
        "Create src/hooks/useAppRouter.ts that wraps useNavigate/useParams to provide similar API to expo-router's useRouter",
        "Export useAppRouter, useRouteParams from hooks",
        "Remove expo-router from dependencies",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-204",
      "workstream": "A",
      "title": "Initialize Capacitor project",
      "description": "As a developer, I need Capacitor initialized so the web app can be wrapped as a native iOS/Android app.",
      "acceptanceCriteria": [
        "Install @capacitor/core and @capacitor/cli",
        "Run npx cap init with appId 'com.thumbcode.app' and appName 'ThumbCode'",
        "Create capacitor.config.ts with webDir pointing to Vite build output (dist/)",
        "Install @capacitor/ios and @capacitor/android",
        "Run npx cap add ios and npx cap add android to generate native projects",
        "Add ios/ and android/ to .gitignore (or commit them per Capacitor convention)",
        "Update package.json scripts: add cap:sync, cap:open:ios, cap:open:android, cap:build",
        "Verify npx cap sync completes without errors after a vite build",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-205",
      "workstream": "B",
      "title": "Create web UI primitives replacing RN components",
      "description": "As a developer, I need web-native primitive components in packages/ui that replace React Native's View, Text, Pressable, ScrollView, FlatList with HTML equivalents using the same prop patterns.",
      "acceptanceCriteria": [
        "Create packages/ui/src/primitives/Box.tsx — a <div> wrapper that accepts className, style, testID (maps to data-testid), children",
        "Create packages/ui/src/primitives/Text.tsx — a <span>/<p> component with className support, accessibilityRole maps to HTML role",
        "Create packages/ui/src/primitives/Button.tsx — a <button> component replacing Pressable, with onPress→onClick mapping, accessibilityRole/Label",
        "Create packages/ui/src/primitives/ScrollArea.tsx — a <div> with overflow-auto and optional scroll styling",
        "Create packages/ui/src/primitives/List.tsx — replaces FlatList with a simple map-based list renderer accepting data and renderItem",
        "Create packages/ui/src/primitives/Image.tsx — standard <img> component",
        "Create packages/ui/src/primitives/TextInput.tsx — <input> component with onChangeText→onChange adapter",
        "Create packages/ui/src/primitives/Switch.tsx — checkbox/toggle component",
        "Update packages/ui/src/primitives/index.ts to export all new primitives",
        "All primitives support className for Tailwind styling",
        "Remove all imports from 'react-native' in packages/ui",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-206",
      "workstream": "B",
      "title": "Migrate form components to web HTML",
      "description": "As a developer, I need form components (TextInput, TextArea, Select) rewritten as web HTML form elements.",
      "acceptanceCriteria": [
        "Rewrite src/components/form/TextInput.tsx using <input> element with Tailwind organic styling, label, helper text, error state",
        "Rewrite src/components/form/TextArea.tsx using <textarea> element with character count, label, error state",
        "Rewrite src/components/form/Select.tsx using <select>/<option> elements if it exists, or create it",
        "Keep the same public prop interfaces (label, helper, error, value, onChangeText→onChange)",
        "Apply organic border-radius via CSS (not RN style objects)",
        "Remove all imports from 'react-native' in src/components/form/",
        "Remove jest.mock for expo modules from form test files",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-207",
      "workstream": "B",
      "title": "Migrate feedback components and icons to web",
      "description": "As a developer, I need Modal, BottomSheet, Toast components rewritten using HTML dialog/portals and icons switched from @expo/vector-icons to lucide-react.",
      "acceptanceCriteria": [
        "Rewrite src/components/feedback/Modal.tsx using HTML <dialog> element or portal-based modal with Tailwind styling",
        "Rewrite ConfirmDialog to use the new web Modal",
        "Rewrite src/components/feedback/BottomSheet.tsx as a slide-up panel using CSS transforms",
        "Rewrite src/components/feedback/Toast.tsx as a web toast notification",
        "Install lucide-react and replace all @expo/vector-icons (Ionicons) imports with Lucide equivalents",
        "Update packages/ui/src/icons/ to use Lucide icons instead of Ionicons",
        "Update icon name mapping in iconMap.ts for Lucide icon names",
        "Remove @expo/vector-icons from dependencies",
        "Remove all imports from 'react-native' in feedback components",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-208",
      "workstream": "C",
      "title": "Migrate root layout and tab navigation",
      "description": "As a developer, I need the root layout and tab navigation converted from expo-router Stack/Tabs to React Router Outlet with a tab bar component.",
      "acceptanceCriteria": [
        "Rewrite app/_layout.tsx → src/layouts/RootLayout.tsx using React Router <Outlet>, conditional onboarding vs app routing",
        "Rewrite app/(tabs)/_layout.tsx → src/layouts/TabLayout.tsx with a bottom tab bar using <NavLink> for active state",
        "Tab bar shows: Home, Agents, Projects, Settings, Chat icons using Lucide",
        "Active tab highlighted with coral color",
        "Tab layout renders <Outlet> for child routes",
        "Remove expo-router Stack and Tabs imports entirely",
        "Move reusable layout components from app/ into src/layouts/",
        "AppProviders.tsx updated: remove expo-status-bar StatusBar, use standard React context providers",
        "All layouts use Tailwind classes (no NativeWind, no RN StyleSheet)",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-209",
      "workstream": "C",
      "title": "Migrate onboarding screens to web React",
      "description": "As a developer, I need all 5 onboarding screens converted from React Native components to web React with HTML elements.",
      "acceptanceCriteria": [
        "Rewrite welcome.tsx: Replace View→div, Text→span/h1/p, Pressable→button, useRouter→useNavigate",
        "Rewrite github-auth.tsx: Same component migration, keep auth flow logic",
        "Rewrite api-keys.tsx: Replace TextInput with <input>, update form handling",
        "Rewrite create-project.tsx: Replace FlatList with map, RN components with HTML",
        "Rewrite complete.tsx: Simple HTML migration",
        "Move all from app/(onboarding)/ to src/pages/onboarding/",
        "All screens use Tailwind classes for styling",
        "All screens use useNavigate for navigation (not useRouter from expo-router)",
        "Remove all imports from 'react-native' and 'expo-router' in onboarding pages",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-210",
      "workstream": "C",
      "title": "Migrate main tab screens to web React",
      "description": "As a developer, I need the 5 main tab screens (home, agents, projects, settings, chat) converted to web React.",
      "acceptanceCriteria": [
        "Rewrite index.tsx (home/dashboard): View→div, Text→span/h1, Pressable→button, FlatList→mapped list",
        "Rewrite agents.tsx: Agent list with Lucide icons, web components",
        "Rewrite projects.tsx: Project cards with web components, organic styling via Tailwind",
        "Rewrite settings.tsx: Settings list with web components",
        "Rewrite chat.tsx: Chat interface with web components, replace RN ScrollView with div overflow-y-auto",
        "Move all from app/(tabs)/ to src/pages/",
        "All screens use Tailwind classes for styling",
        "Remove all imports from 'react-native' and 'expo-router'",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-211",
      "workstream": "C",
      "title": "Migrate detail and settings sub-screens to web React",
      "description": "As a developer, I need detail views (agent/[id], project/[id]) and settings sub-screens converted to web React.",
      "acceptanceCriteria": [
        "Rewrite agent/[id].tsx → src/pages/agent/AgentDetail.tsx: useParams for id, web components",
        "Rewrite project/[id].tsx → src/pages/project/ProjectDetail.tsx: useParams for id, web components, file explorer tab",
        "Rewrite settings/agents.tsx → src/pages/settings/AgentSettings.tsx",
        "Rewrite settings/credentials.tsx → src/pages/settings/CredentialSettings.tsx",
        "Rewrite settings/editor.tsx → src/pages/settings/EditorSettings.tsx",
        "Create src/pages/NotFound.tsx replacing app/+not-found.tsx",
        "All screens use useNavigate and useParams from react-router-dom",
        "Remove all imports from 'react-native' and 'expo-router'",
        "Update route config in src/router.tsx to include all pages",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-212",
      "workstream": "D",
      "title": "Replace expo-secure-store with Capacitor secure storage",
      "description": "As a developer, I need credential storage migrated from expo-secure-store to a Capacitor-compatible secure storage plugin.",
      "acceptanceCriteria": [
        "Install @capacitor/preferences for general storage",
        "Install capacitor-secure-storage-plugin for encrypted key storage",
        "Rewrite packages/core/src/credentials/KeyStorage.ts: replace SecureStore.getItemAsync → SecureStoragePlugin.get, setItemAsync → set, deleteItemAsync → remove",
        "Keep the same public API (saveCredential, getCredential, deleteCredential, listCredentials)",
        "Remove expo-secure-store from all package.json files",
        "Update jest.setup.js: replace expo-secure-store mock with capacitor-secure-storage-plugin mock",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-213",
      "workstream": "D",
      "title": "Replace expo-local-authentication with Capacitor biometric",
      "description": "As a developer, I need biometric authentication migrated from expo-local-authentication to a Capacitor biometric plugin.",
      "acceptanceCriteria": [
        "Install capacitor-native-biometric (or @aparajita/capacitor-biometric-auth)",
        "Rewrite biometric calls in KeyStorage.ts: authenticateAsync → NativeBiometric.verifyIdentity, isEnrolledAsync → NativeBiometric.isAvailable",
        "Keep the same biometric flow: check availability, prompt user, authenticate",
        "Update type imports: replace LocalAuthentication types with Capacitor biometric types",
        "Remove expo-local-authentication from all package.json files",
        "Update jest.setup.js: replace expo-local-authentication mock with Capacitor biometric mock",
        "Remove Face ID permission from app.json (now in capacitor.config.ts or Info.plist)",
        "Add NSFaceIDUsageDescription to ios/App/App/Info.plist if ios/ dir exists",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-214",
      "workstream": "D",
      "title": "Replace expo-file-system with Capacitor Filesystem",
      "description": "As a developer, I need the git file system adapter migrated from expo-file-system to @capacitor/filesystem.",
      "acceptanceCriteria": [
        "Install @capacitor/filesystem",
        "Rewrite packages/core/src/git/git-fs.ts: replace FileSystem.readAsStringAsync → Filesystem.readFile, writeAsStringAsync → writeFile, deleteAsync → deleteFile, makeDirectoryAsync → mkdir, readDirectoryAsync → readdir",
        "Map Capacitor Filesystem Directory enum for document storage",
        "Keep the isomorphic-git FS interface contract (readFile, writeFile, unlink, mkdir, rmdir, stat, readdir)",
        "Update GitCloneService.ts: replace FileSystem.documentDirectory with Capacitor Filesystem paths",
        "Update GitDiffService.ts: replace any FileSystem references",
        "Remove expo-file-system from all package.json files",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-215",
      "workstream": "D",
      "title": "Replace remaining Expo plugins (crypto, device, constants, auth-session, status-bar)",
      "description": "As a developer, I need all remaining Expo native modules replaced with web APIs or Capacitor equivalents.",
      "acceptanceCriteria": [
        "Replace expo-crypto with Web Crypto API: Crypto.getRandomBytes → crypto.getRandomValues, digestStringAsync → crypto.subtle.digest in RequestSigningService.ts",
        "Replace expo-device with @capacitor/device: Device.isRootedExperimentalAsync → Device.getInfo() in RuntimeSecurityService.ts",
        "Replace expo-constants with import.meta.env (Vite): rewrite src/lib/env.ts to use import.meta.env.VITE_* instead of Constants.expoConfig.extra",
        "Replace expo-auth-session: remove dependency (auth flow already uses manual fetch-based Device Flow)",
        "Remove expo-status-bar (already handled by removing StatusBar component from AppProviders)",
        "Remove expo-splash-screen, expo-updates, expo-clipboard, expo-haptics, expo-image, expo-linking, expo-notifications, expo-web-browser (unused or not applicable)",
        "Remove ALL expo-* packages from all package.json files",
        "Remove the 'expo' core package itself from dependencies",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-216",
      "workstream": "E",
      "title": "Remove all React Native dependencies",
      "description": "As a developer, I need every React Native dependency removed since this is now a pure web + Capacitor app.",
      "acceptanceCriteria": [
        "Remove react-native from dependencies",
        "Remove react-native-web from dependencies",
        "Remove react-native-gesture-handler from dependencies",
        "Remove react-native-reanimated from dependencies",
        "Remove react-native-safe-area-context from dependencies",
        "Remove react-native-screens from dependencies",
        "Remove react-native-svg from dependencies (use inline SVG or lucide-react)",
        "Remove react-native-ssl-public-key-pinning from dependencies",
        "Remove react-native-css-interop from dependencies",
        "Remove @react-native-async-storage/async-storage — replace with localStorage or @capacitor/preferences in Zustand persist config",
        "Remove @react-native-community/netinfo — replace with navigator.onLine",
        "Remove @react-navigation/native from dependencies (now using react-router-dom)",
        "Update packages/state Zustand persist to use localStorage instead of AsyncStorage",
        "Run pnpm install to clean lockfile",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-217",
      "workstream": "E",
      "title": "Replace jest-expo with Vitest",
      "description": "As a developer, I need the test framework migrated from jest-expo to Vitest for the web-first architecture.",
      "acceptanceCriteria": [
        "Install vitest, @testing-library/react, @testing-library/jest-dom, jsdom as devDependencies",
        "Create vitest.config.ts extending vite.config.ts with test environment jsdom",
        "Create vitest.setup.ts replacing jest.setup.js with web-appropriate mocks (Capacitor plugins, localStorage)",
        "Update package.json scripts: test → vitest run, test:watch → vitest, test:coverage → vitest run --coverage",
        "Delete jest.config.js",
        "Delete jest.setup.js",
        "Remove jest, jest-expo, @types/jest, react-test-renderer, @types/react-test-renderer from devDependencies",
        "Remove @testing-library/react-native (replace with @testing-library/react)",
        "Update tsconfig to include vitest/globals types instead of jest",
        "A basic smoke test (import App, render, expect truthy) passes with vitest",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-218",
      "workstream": "E",
      "title": "Update all test files for web components",
      "description": "As a developer, I need all existing tests updated to work with web React components and Vitest instead of RN + jest-expo.",
      "acceptanceCriteria": [
        "Update all test imports: replace react-test-renderer with @testing-library/react",
        "Replace render from @testing-library/react-native with render from @testing-library/react",
        "Replace jest.fn() with vi.fn() throughout all test files",
        "Replace jest.mock() with vi.mock() throughout all test files",
        "Remove all jest.mock for expo-* modules (no longer needed)",
        "Remove all jest.mock for react-native modules (no longer needed)",
        "Update component assertions: toJSON() → screen queries (getByText, getByRole, etc.)",
        "Update form interaction tests to use web events (fireEvent.click, fireEvent.change)",
        "Fix imports in test files for moved page files (app/(tabs)/ → src/pages/)",
        "All tests pass with vitest run",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-219",
      "workstream": "F",
      "title": "Update CI/CD workflows for Capacitor builds",
      "description": "As a developer, I need GitHub Actions CI/CD updated to build with Vite + Capacitor instead of Expo + EAS.",
      "acceptanceCriteria": [
        "Update .github/workflows/ci.yml: replace 'expo export --platform web' with 'pnpm build' (vite build)",
        "Remove expo-compatibility-report job from ci.yml",
        "Update test job to use vitest instead of jest",
        "Update build-web job to use vite build",
        "Update e2e-web job: webServer command should use 'pnpm preview' instead of serve + fix-web-export",
        "Rewrite .github/workflows/cd.yml: remove all EAS build/update jobs",
        "Add Capacitor sync step to CD: npx cap sync after vite build",
        "Remove expo/expo-github-action from CD workflow",
        "Remove EXPO_TOKEN secret references",
        "Delete eas.json",
        "Delete app.json (Expo config no longer needed)",
        "Delete app.config.ts",
        "Delete scripts/check-expo-compatibility.js",
        "Delete scripts/fix-web-export.py (Vite output is already proper ES modules)",
        "Update render.yaml: buildCommand to 'pnpm install && pnpm build', staticPublishPath to ./dist",
        "Update .github/actions/setup-thumbcode/action.yml if needed",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    }
  ]
}
