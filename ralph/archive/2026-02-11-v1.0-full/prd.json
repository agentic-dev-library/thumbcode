{
  "project": "ThumbCode",
  "branchName": "ralph/v1.0-full",
  "description": "ThumbCode v1.0 — Full implementation of all gaps, decompositions, testing, quality, and documentation from PRD-v1.0.md",
  "workstreams": {
    "A": "decomposition",
    "B": "ai-integration",
    "C": "testing",
    "D": "documentation",
    "E": "quality",
    "F": "features"
  },
  "userStories": [
    {
      "id": "US-001",
      "workstream": "A",
      "title": "Decompose PaintDaubeIcon into icon registry with lazy loading",
      "description": "As a developer, I want the 1,268-line PaintDaubeIcon.tsx split into individual icon files so the bundle loads faster and icons are maintainable.",
      "acceptanceCriteria": [
        "Create src/components/icons/ directory with one file per icon variant (daube-check.tsx, daube-key.tsx, etc.)",
        "Create src/components/icons/index.ts barrel export with lazy loading via React.lazy",
        "Original PaintDaubeIcon.tsx replaced with a thin wrapper that delegates to individual icons",
        "All existing imports of PaintDaubeIcon continue to work",
        "No icon file exceeds 100 lines",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "workstream": "A",
      "title": "Decompose types/index.ts into domain-specific type files",
      "description": "As a developer, I want types split by domain so imports are clearer and files are focused.",
      "acceptanceCriteria": [
        "Create src/types/agent.ts with all agent-related types",
        "Create src/types/project.ts with all project-related types",
        "Create src/types/workspace.ts with all workspace-related types",
        "Create src/types/credentials.ts with all credential-related types",
        "Create src/types/chat.ts with all chat/message-related types",
        "src/types/index.ts re-exports everything for backward compatibility",
        "All existing imports continue to work",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "workstream": "A",
      "title": "Decompose GitService.ts into focused service modules",
      "description": "As a developer, I want the 1,055-line GitService split by concern for maintainability.",
      "acceptanceCriteria": [
        "Create packages/core/src/git/GitCloneService.ts with clone/fetch operations",
        "Create packages/core/src/git/GitDiffService.ts with diff/status operations",
        "Create packages/core/src/git/GitBranchService.ts with branch management",
        "Create packages/core/src/git/GitCommitService.ts with commit/push operations",
        "GitService.ts becomes a thin facade delegating to sub-services",
        "No sub-service file exceeds 300 lines",
        "All existing tests continue to pass",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "workstream": "A",
      "title": "Decompose orchestrator.ts into focused modules",
      "description": "As a developer, I want the 512-line orchestrator split into TaskAssigner, AgentCoordinator, and OrchestrationState.",
      "acceptanceCriteria": [
        "Create packages/agent-intelligence/src/services/orchestrator/TaskAssigner.ts",
        "Create packages/agent-intelligence/src/services/orchestrator/AgentCoordinator.ts",
        "Create packages/agent-intelligence/src/services/orchestrator/OrchestrationState.ts",
        "orchestrator.ts becomes a facade composing the three modules",
        "All existing tests continue to pass",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "workstream": "A",
      "title": "Decompose ChatService.ts into focused modules",
      "description": "As a developer, I want the 442-line ChatService split into MessageStore, StreamHandler, and response service.",
      "acceptanceCriteria": [
        "Create src/services/chat/MessageStore.ts for message CRUD and thread management",
        "Create src/services/chat/StreamHandler.ts for streaming response handling",
        "ChatService.ts becomes a facade composing the modules",
        "simulateAgentResponse and getAgentResponsePlaceholder remain in a separate AgentResponseService.ts (to be replaced by real AI in US-009)",
        "All existing imports continue to work",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "workstream": "A",
      "title": "Decompose CredentialService.ts into focused modules",
      "description": "As a developer, I want the 460-line CredentialService split into KeyValidator, KeyStorage, and KeyRotation.",
      "acceptanceCriteria": [
        "Create packages/core/src/credentials/KeyValidator.ts for API key format validation",
        "Create packages/core/src/credentials/KeyStorage.ts for secure storage operations",
        "CredentialService.ts becomes a facade",
        "All existing tests continue to pass",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "workstream": "A",
      "title": "Decompose GitHubAuthService.ts into focused modules",
      "description": "As a developer, I want the 407-line GitHubAuthService split into DeviceFlowHandler, TokenManager, and PollingService.",
      "acceptanceCriteria": [
        "Create packages/core/src/auth/DeviceFlowHandler.ts for device code flow",
        "Create packages/core/src/auth/TokenManager.ts for token storage and refresh",
        "Create packages/core/src/auth/PollingService.ts for polling logic",
        "GitHubAuthService.ts becomes a facade",
        "All existing tests continue to pass",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "workstream": "A",
      "title": "Decompose base-agent.ts into mixins/traits",
      "description": "As a developer, I want the 492-line base-agent split into composable behaviors.",
      "acceptanceCriteria": [
        "Create packages/agent-intelligence/src/services/agents/traits/Promptable.ts",
        "Create packages/agent-intelligence/src/services/agents/traits/Reviewable.ts",
        "Create packages/agent-intelligence/src/services/agents/traits/Committable.ts",
        "base-agent.ts composes traits instead of containing all logic",
        "All existing tests continue to pass",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "workstream": "A",
      "title": "Extract component definitions from app/_layout.tsx",
      "description": "As a developer, I want inline component definitions in _layout.tsx extracted to separate files.",
      "acceptanceCriteria": [
        "Identify all component definitions inside app/_layout.tsx",
        "Extract each to its own file in src/components/layout/",
        "app/_layout.tsx imports from the new files",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "SonarCloud flagged 5 component definitions inside _layout.tsx"
    },
    {
      "id": "US-010",
      "workstream": "B",
      "title": "Create AI client abstraction layer",
      "description": "As a developer, I need a unified AI client interface that both Anthropic and OpenAI clients implement.",
      "acceptanceCriteria": [
        "Create src/services/ai/types.ts with AIClient interface (sendMessage, streamMessage)",
        "Create src/services/ai/AIClientFactory.ts that instantiates the right client based on provider",
        "Interface supports streaming responses with abort capability",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "workstream": "B",
      "title": "Implement Anthropic streaming client",
      "description": "As a user, I want my Anthropic API key to power real agent responses with streaming.",
      "acceptanceCriteria": [
        "Create src/services/ai/AnthropicClient.ts implementing AIClient interface",
        "Uses @anthropic-ai/sdk (already installed) for API calls",
        "Supports streaming responses via MessageStream",
        "Reads API key from credential store (expo-secure-store)",
        "Includes abort/cancel support",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "workstream": "B",
      "title": "Implement OpenAI streaming client",
      "description": "As a user, I want my OpenAI API key to power real agent responses with streaming.",
      "acceptanceCriteria": [
        "Create src/services/ai/OpenAIClient.ts implementing AIClient interface",
        "Uses openai SDK (already installed) for API calls",
        "Supports streaming responses",
        "Reads API key from credential store",
        "Includes abort/cancel support",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "workstream": "B",
      "title": "Replace ChatService mock with real AI streaming",
      "description": "As a user, I want agent responses to come from real AI models instead of hardcoded mock text.",
      "acceptanceCriteria": [
        "Remove simulateAgentResponse() and getAgentResponsePlaceholder() from ChatService",
        "ChatService uses AIClientFactory to get the appropriate AI client",
        "Responses stream token-by-token to the UI",
        "Falls back to error message if no API key configured",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Depends on US-010, US-011, US-012"
    },
    {
      "id": "US-014",
      "workstream": "B",
      "title": "Implement multi-agent response routing",
      "description": "As a user, I want different agent types (Architect, Implementer, Reviewer, Tester) to use different system prompts.",
      "acceptanceCriteria": [
        "Create src/services/ai/AgentPrompts.ts with system prompts per agent type",
        "ChatService routes messages to the AI client with the correct system prompt based on agent type",
        "Each agent type has a distinct personality and capability focus",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Depends on US-013"
    },
    {
      "id": "US-015",
      "workstream": "C",
      "title": "Add screen tests for tab screens",
      "description": "As a developer, I want all 5 tab screens to have basic render tests.",
      "acceptanceCriteria": [
        "Create app/(tabs)/__tests__/index.test.tsx for Dashboard",
        "Create app/(tabs)/__tests__/chat.test.tsx for Chat",
        "Create app/(tabs)/__tests__/projects.test.tsx for Projects",
        "Create app/(tabs)/__tests__/settings.test.tsx for Settings",
        "Existing agents.test.tsx continues to pass",
        "Each test verifies basic render without crashes and key UI elements present",
        "Tests pass"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "workstream": "C",
      "title": "Add screen tests for onboarding screens",
      "description": "As a developer, I want all 5 onboarding screens to have basic render tests.",
      "acceptanceCriteria": [
        "Create tests for welcome.tsx, api-keys.tsx, github-auth.tsx, create-project.tsx, complete.tsx",
        "Each test verifies basic render and key UI elements",
        "Tests pass"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "workstream": "C",
      "title": "Add screen tests for settings and detail screens",
      "description": "As a developer, I want settings screens and dynamic route screens to have render tests.",
      "acceptanceCriteria": [
        "Create tests for settings/credentials.tsx, settings/agents.tsx, settings/editor.tsx",
        "Create tests for agent/[id].tsx, project/[id].tsx",
        "Each test provides mock route params for dynamic routes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "workstream": "C",
      "title": "Enable and fix E2E web test suites",
      "description": "As a developer, I want the skipped E2E tests enabled and passing.",
      "acceptanceCriteria": [
        "Remove skip markers from e2e/web/dashboard.spec.ts and e2e/web/interactions.spec.ts",
        "Fix or update test assertions to match current UI",
        "All E2E web tests pass with 'pnpm run test:e2e:web'",
        "Tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": "May need web build first"
    },
    {
      "id": "US-019",
      "workstream": "C",
      "title": "Add integration tests for auth and chat flows",
      "description": "As a developer, I want integration tests covering the auth flow and chat message flow.",
      "acceptanceCriteria": [
        "Create src/services/__tests__/auth-flow.integration.test.ts testing GitHub Device Flow end-to-end with mocked HTTP",
        "Create src/services/__tests__/chat-flow.integration.test.ts testing message send → agent response cycle",
        "Tests use proper mocking of external APIs",
        "Tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "workstream": "C",
      "title": "Add tests for untested packages (config, types, ui)",
      "description": "As a developer, I want all 7 packages to have at least basic test coverage.",
      "acceptanceCriteria": [
        "Create packages/config/src/__tests__/env.test.ts",
        "Create packages/config/src/__tests__/features.test.ts",
        "Create packages/types/src/__tests__/validation.test.ts (if types have runtime validators)",
        "Create packages/ui/src/__tests__/components.test.ts for at least 3 UI components",
        "Tests pass"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "workstream": "D",
      "title": "Add READMEs for all 7 packages",
      "description": "As a developer, I want each package to have a README explaining its purpose, API, and usage.",
      "acceptanceCriteria": [
        "Create README.md for: agent-intelligence, config, core, state, types, ui (dev-tools already has one)",
        "Each README includes: description, installation, API overview, usage examples",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "workstream": "D",
      "title": "Create CHANGELOG.md and test guide documentation",
      "description": "As a developer, I want a CHANGELOG tracking releases and a guide for running/writing tests.",
      "acceptanceCriteria": [
        "Create CHANGELOG.md with v0.1.0 entry summarizing current state",
        "Create docs/development/TESTING.md with: how to run tests, how to add tests, test architecture, coverage targets",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "workstream": "D",
      "title": "Add JSDoc to all public UI component props",
      "description": "As a developer, I want all component props in src/components/ to have JSDoc descriptions.",
      "acceptanceCriteria": [
        "All exported interface/type definitions in src/components/ have JSDoc comments on each prop",
        "At minimum cover: ui/, agents/, chat/, workspace/ component directories",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "workstream": "E",
      "title": "Fix SonarCloud bug and security hotspots",
      "description": "As a developer, I want the 1 SonarCloud bug and 2 security hotspots resolved.",
      "acceptanceCriteria": [
        "Fix Promise-returning function bug in app/settings/credentials.tsx:207",
        "Review and resolve both security hotspots",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "workstream": "E",
      "title": "Fix critical SonarCloud code smells: void operators and nested ternaries",
      "description": "As a developer, I want the 3 critical and high-severity code smells fixed.",
      "acceptanceCriteria": [
        "Replace void operator usage in chat.tsx, Progress.tsx, DiffViewer.tsx with explicit handling",
        "Replace nested ternaries (12 instances) with helper functions or switch statements",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "workstream": "E",
      "title": "Add Readonly<> to component prop types and fix non-readonly class members",
      "description": "As a developer, I want prop interfaces wrapped in Readonly<> and class members marked readonly where appropriate.",
      "acceptanceCriteria": [
        "Add Readonly<> wrapper to 10+ component prop type annotations",
        "Add readonly keyword to 4 class member instances flagged by SonarCloud",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "workstream": "F",
      "title": "Implement credential validation on API key entry",
      "description": "As a user, I want my API keys validated against the actual API when I enter them.",
      "acceptanceCriteria": [
        "When saving an Anthropic key, make a minimal API call (list models or tiny completion) to verify it works",
        "When saving an OpenAI key, make a minimal API call to verify",
        "When saving a GitHub token, verify with /user endpoint",
        "Show success/error feedback in the UI",
        "Invalid keys are not saved",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "workstream": "F",
      "title": "Implement project creation via GitHub API",
      "description": "As a user, I want to create a new GitHub repository from the create-project screen.",
      "acceptanceCriteria": [
        "Replace 'coming soon' placeholder in create-project.tsx with working form",
        "Uses GitHub API (via user's token) to create a new repository",
        "Supports setting repo name, description, visibility (public/private)",
        "Shows loading and error states",
        "After creation, navigates to the new project",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-029",
      "workstream": "F",
      "title": "Add syntax highlighting to CodeBlock component",
      "description": "As a user, I want code blocks in chat to have proper syntax highlighting.",
      "acceptanceCriteria": [
        "Replace placeholder highlighting in src/components/chat/CodeBlock.tsx",
        "Use a lightweight RN-compatible syntax highlighter",
        "Support at minimum: TypeScript, JavaScript, JSON, Python, Bash",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "workstream": "F",
      "title": "Remove dead code and clean up verify.tsx",
      "description": "As a developer, I want dead code removed to reduce confusion.",
      "acceptanceCriteria": [
        "Delete app/verify.tsx (demo/test screen with no navigation path)",
        "Remove any imports or references to verify.tsx",
        "Verify no broken links or navigation references",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    }
  ]
}
