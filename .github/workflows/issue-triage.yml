name: Issue Triage

on:
  issues:
    types: [opened]

permissions:
  contents: read
  issues: write
  id-token: write

jobs:
  triage:
    name: Claude Issue Triage
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout code
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          fetch-depth: 0

      - name: Triage Issue
        uses: anthropics/claude-code-action@a017b830c03e23789b11fb69ed571ea61c12e45c # v1.0.30
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          allow_any_user: true
          prompt: |
            Triage this issue: #${{ github.event.issue.number }}

            **Issue Title:** ${{ github.event.issue.title }}
            **Issue Body:**
            ```
            ${{ github.event.issue.body }}
            ```

            **Repository:** ${{ github.repository }}
            **Author:** @${{ github.event.issue.user.login }}

            Please analyze and:

            1. **Categorize** - Add appropriate labels:
               - Type: `bug`, `feature`, `enhancement`, `documentation`, `question`
               - Priority: `priority: high`, `priority: medium`, `priority: low`
               - Area: `area: agents`, `area: ui`, `area: docs`, `area: ci`, `area: design`, `area: git`
               - Status: `status: needs-triage`, `status: ready`, `status: blocked`

            2. **Validate** - Check if:
               - Issue is clear and actionable
               - Contains reproduction steps (for bugs)
               - Aligns with project goals (check VISION.md)
               - Is a duplicate (search existing issues)

            3. **Respond** - Add a comment with:
               - Summary of the issue
               - Recommended next steps
               - Ask for clarification if needed
               - Link to relevant documentation
               - Mention if it's a duplicate

            4. **Assign** - If this is:
               - A bug: Add `bug` label
               - A feature: Check if it aligns with roadmap in PROJECT-STATUS.md
               - Documentation: Add `documentation` label
               - Question: Add `question` label and link to docs

            Use GitHub's labeling system to categorize appropriately.
