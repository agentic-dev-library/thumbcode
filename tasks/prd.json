{
  "name": "ThumbCode v1.0 Consolidation & Completion",
  "branchName": "main",
  "description": "Reconnect disconnected packages, refactor monoliths (TSX=design, logic=packages), consolidate docs into Cline-style memory bank, achieve 80%+ test coverage, wire multi-agent pipeline end-to-end.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Modernize agent-intelligence package for web",
      "description": "As a developer, I need @thumbcode/agent-intelligence updated for the Capacitor/Vite web stack so it can be imported by src/.",
      "acceptanceCriteria": [
        "Remove react-native: 0.76.0 dependency from packages/agent-intelligence/package.json",
        "Replace jest with vitest for testing in packages/agent-intelligence/",
        "Remove all React Native-specific imports and types from the package",
        "Add @thumbcode/agent-intelligence: workspace:* to root package.json dependencies",
        "pnpm install resolves cleanly with no peer dependency warnings for RN",
        "All existing tests in the package pass under Vitest",
        "pnpm typecheck passes with packages/agent-intelligence/ included in tsconfig",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "",
      "dependsOn": []
    },
    {
      "id": "US-002",
      "title": "Replace src/services/ai/ with agent-intelligence AI clients",
      "description": "As a developer, I want src/ to use the advanced AI clients from @thumbcode/agent-intelligence (with tool calling, token tracking, rich streaming events) instead of the simplified duplicates in src/services/ai/.",
      "acceptanceCriteria": [
        "src/services/chat/AgentResponseService.ts imports AI client from @thumbcode/agent-intelligence instead of src/services/ai/",
        "Tool calling support is available through the imported client",
        "Token usage tracking is exposed via the client interface",
        "Streaming works with the same UX (typing indicator, progressive text render)",
        "src/services/ai/ directory is deleted (no longer needed)",
        "All existing chat tests pass with the new client",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Merged to main via ralph session. src/services/ai/ deleted, AgentResponseService imports from @thumbcode/agent-intelligence.",
      "dependsOn": ["US-001"]
    },
    {
      "id": "US-003",
      "title": "Wire orchestrator for single-agent routing",
      "description": "As a user, I want my messages routed through the AgentOrchestrator so the right specialized agent responds, even for simple single-agent questions.",
      "acceptanceCriteria": [
        "AgentResponseService uses AgentOrchestrator from @thumbcode/agent-intelligence for message routing",
        "Simple questions are routed to the appropriate agent (Architect for design, Implementer for code, etc.)",
        "Single-agent responses stream to the chat UI with the same UX as before",
        "Orchestrator errors are caught and displayed gracefully in chat",
        "Unit tests cover single-agent routing for each agent type",
        "Unit tests cover error handling when orchestrator fails",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-002"]
    },
    {
      "id": "US-004",
      "title": "Wire orchestrator for multi-agent pipeline with task queue",
      "description": "As a user, I want multi-step requests to create a visible task queue where specialized agents collaborate (Architect -> Implementer -> Reviewer -> Tester).",
      "acceptanceCriteria": [
        "Multi-step requests create a task queue visible in the chat UI",
        "Agent handoffs are reflected in chat (e.g. Architect finished, handing to Implementer)",
        "User can approve/reject at each stage via the existing ApprovalCard component",
        "Task queue shows progress (which agent is active, which are pending/complete)",
        "Unit tests cover multi-agent pipeline and handoff sequence",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-003"]
    },
    {
      "id": "US-005",
      "title": "Connect agent read tools to core git services",
      "description": "As a user, I want agents to read files and diffs from the repository through tool execution connected to packages/core/ git services.",
      "acceptanceCriteria": [
        "Reviewer agent read_file tool calls GitDiffService to show changes",
        "Tester agent can read test output and report results",
        "Tool execution bridge connects agent tool definitions to core service methods",
        "Unit tests mock git operations and verify the read-tool-to-service bridge",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-004"]
    },
    {
      "id": "US-006",
      "title": "Connect agent write tools and approval-triggered commits",
      "description": "As a user, I want Implementer agent write_file tool to stage changes, and approval in chat to trigger actual git commits.",
      "acceptanceCriteria": [
        "Implementer agent write_file tool calls GitCommitService to stage changes",
        "Approval in chat triggers actual git commit via GitCommitService",
        "Rejection in chat discards staged changes",
        "Commit message includes agent context (which agent, what task)",
        "Unit tests mock git operations and verify write-tool-to-commit flow",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-005"]
    },
    {
      "id": "US-007",
      "title": "Establish packages/ui/ as canonical component library",
      "description": "As a developer, I want src/components/ui/ to import from @thumbcode/ui so the design system has a single source of truth.",
      "acceptanceCriteria": [
        "src/components/ui/Button.tsx imports and re-exports from @thumbcode/ui",
        "src/components/ui/Card.tsx imports and re-exports from @thumbcode/ui",
        "src/components/ui/Input.tsx imports and re-exports from @thumbcode/ui",
        "src/components/ui/Text.tsx imports and re-exports from @thumbcode/ui",
        "Unique primitives from packages/ui/ (Box, ScrollArea, List, Image, Switch, Spinner, Alert) available via @thumbcode/ui",
        "Dead underscore-prefixed constants (_SPINNER_COLORS, _PLACEHOLDER_COLOR) removed from src/components/ui/",
        "All screens render identically before and after",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Merged to main. src/components/ui/ re-exports from @thumbcode/ui. Dead constants removed.",
      "dependsOn": []
    },
    {
      "id": "US-008",
      "title": "Refactor chat.tsx -- extract logic, use existing components",
      "description": "As a developer, I want pages/tabs/chat.tsx (510 lines) to be a thin composition layer that imports components from components/chat/ and logic from services.",
      "acceptanceCriteria": [
        "formatTime(), formatRelativeTime(), getSenderInfo(), getParticipantColor() extracted to src/lib/chat-utils.ts",
        "ThreadItem, ChatMessageView, ChatInputBar inline components deleted from chat.tsx",
        "Page imports ThreadList, ChatMessage, ChatInput from components/chat/",
        "Unused Zustand subscriptions (_projects, _userProfile at lines 420-421) removed",
        "chat.tsx is under 150 lines",
        "All chat functionality works identically (threads, messages, agent selection, typing indicators)",
        "Unit tests cover the extracted chat-utils utilities",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-002"]
    },
    {
      "id": "US-009",
      "title": "Refactor create-project.tsx -- extract form logic",
      "description": "As a developer, I want pages/onboarding/create-project.tsx (411 lines) to delegate form logic to service functions and use existing decomposed components.",
      "acceptanceCriteria": [
        "Repository listing logic extracted to a service function in @thumbcode/core or src/services/",
        "Form validation logic extracted from TSX into a validation module",
        "create-project.tsx uses RepoSelector and ProjectForm from components/onboarding/ instead of reimplementing inline",
        "create-project.tsx is under 150 lines",
        "Existing onboarding tests still pass",
        "New unit tests cover the extracted service functions",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Merged to main. useCreateProject hook, repository-service, validation module extracted. Page reduced from 411 to ~100 lines. Tests added.",
      "dependsOn": []
    },
    {
      "id": "US-010",
      "title": "Refactor ProjectDetail.tsx -- extract logic to hooks",
      "description": "As a developer, I want pages/detail/ProjectDetail.tsx (402 lines) to have file explorer logic in a service, project actions in a hook, and the page under 200 lines.",
      "acceptanceCriteria": [
        "File explorer logic extracted to a useProjectFiles hook or service",
        "Project actions (delete, archive, settings) extracted to a useProjectActions hook",
        "ProjectDetail.tsx is under 200 lines, focused on layout and composition",
        "Page uses ProjectHeader, ProjectFileExplorer, ProjectActions from components/project/",
        "Unit tests cover the extracted hooks",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Merged to main. useProjectFiles, useProjectActions, useProjectCommits hooks extracted. ProjectDetail.tsx under 200 lines. Tests added.",
      "dependsOn": []
    },
    {
      "id": "US-011",
      "title": "Refactor AgentDetail.tsx -- extract logic to hooks",
      "description": "As a developer, I want pages/detail/AgentDetail.tsx (320 lines) to have agent metrics/history logic in a hook and the page under 200 lines.",
      "acceptanceCriteria": [
        "Agent metrics and history logic extracted to a useAgentDetail hook",
        "AgentDetail.tsx is under 200 lines, focused on layout and composition",
        "Page uses AgentActions, AgentHistory, AgentMetrics from components/agents/",
        "Unit tests cover the extracted hook",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "",
      "dependsOn": []
    },
    {
      "id": "US-012",
      "title": "Refactor tab pages -- extract inline logic to hooks",
      "description": "As a developer, I want home.tsx, projects.tsx, and agents.tsx tab pages to have inline data fetching/logic extracted to hooks.",
      "acceptanceCriteria": [
        "pages/tabs/home.tsx: any inline data fetching extracted to a useHomeDashboard hook",
        "pages/tabs/projects.tsx: project list logic extracted to a hook consuming @thumbcode/state",
        "pages/tabs/agents.tsx: agent list logic extracted to a hook consuming @thumbcode/state",
        "Each page is a thin composition layer (TSX = design only)",
        "Each refactored page has a corresponding unit test",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Merged to main. useHomeDashboard, useProjectList, useAgentList hooks extracted. All 3 tab pages are thin composition layers with unit tests.",
      "dependsOn": []
    },
    {
      "id": "US-013",
      "title": "Lazy-load icon-paths.ts and consolidate organic styling",
      "description": "As a developer, I want icon-paths.ts (924 lines) lazy-loaded and one canonical approach for organic styling (Tailwind classes only).",
      "acceptanceCriteria": [
        "icon-paths.ts is dynamically imported only when PaintDaubeIcon uses it as a fallback",
        "Initial bundle size decreases measurably (check with pnpm build output)",
        "Icon rendering still works for all icon variants",
        "All components using style={organicBorderRadius.card} migrated to className=rounded-organic-card",
        "src/lib/organic-styles.ts removed or converted to only generate Tailwind classes",
        "No component uses both JS objects and Tailwind classes for organic styling",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependsOn": []
    },
    {
      "id": "US-014",
      "title": "Create docs/ memory bank foundation files",
      "description": "As a developer or AI agent, I want docs/memory-bank/ with the foundational files (projectbrief, productContext, techContext) populated with current accurate content.",
      "acceptanceCriteria": [
        "Create docs/memory-bank/projectbrief.md with ThumbCode mission, scope, core requirements",
        "Create docs/memory-bank/productContext.md with BYOK model, mobile-first philosophy, user experience goals",
        "Create docs/memory-bank/techContext.md with current tech stack (React 18, Vite 7, Capacitor 8), dev setup, dependencies",
        "All content reflects the CURRENT Capacitor/Vite stack, not the old Expo stack",
        "Content is sourced from existing docs (ARCHITECTURE.md, DECISIONS.md, PRD-v1.0.md) but updated to be accurate",
        "pnpm typecheck passes",
        "pnpm lint passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Merged to main. projectbrief.md, productContext.md, techContext.md created with accurate Capacitor/Vite stack documentation.",
      "dependsOn": []
    },
    {
      "id": "US-015",
      "title": "Create docs/ memory bank working files and subdirectories",
      "description": "As a developer or AI agent, I want docs/memory-bank/ working files (systemPatterns, activeContext, progress) and docs subdirectories for architecture, design, and vision.",
      "acceptanceCriteria": [
        "Create docs/memory-bank/systemPatterns.md with multi-agent architecture, package relationships, data flows",
        "Create docs/memory-bank/activeContext.md with current work focus (v1.0 consolidation), recent changes, next steps",
        "Create docs/memory-bank/progress.md with what works, what is left, known issues, feature status",
        "Create docs/architecture/ directory with migrated and updated architecture docs",
        "Create docs/design/ directory with brand identity and design system docs",
        "Create docs/vision/ directory with PRD and roadmap docs",
        "pnpm typecheck passes",
        "pnpm lint passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-014"]
    },
    {
      "id": "US-016",
      "title": "Create AGENTS.md and update CLAUDE.md",
      "description": "As an AI agent, I want AGENTS.md as the operational guide for multi-agent workflows, with CLAUDE.md pointing to it and docs/ for details.",
      "acceptanceCriteria": [
        "Create AGENTS.md at repo root with agent roles, orchestration workflow, tool definitions, Ralph integration instructions",
        "Update CLAUDE.md to reference current stack (Vite, Capacitor, react-router-dom, Tailwind CSS)",
        "CLAUDE.md points to AGENTS.md for multi-agent workflows",
        "CLAUDE.md points to docs/memory-bank/ for project context",
        "Remove all stale Expo/NativeWind/expo-router/gluestack references from CLAUDE.md",
        "Keep brand identity section (colors, typography, organic style) as-is in CLAUDE.md",
        "Delete or archive stale root-level docs: ARCHITECTURE.md, DEVELOPMENT-LOG.md, PROJECT-STATUS.md, DECISIONS.md (content already moved to docs/)",
        "Delete thumbcode-agent-playbook.md (duplicate of CLAUDE.md)",
        "pnpm typecheck passes",
        "pnpm lint passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-015"]
    },
    {
      "id": "US-017",
      "title": "Update config files and remove Expo vestiges",
      "description": "As a developer, I want configuration files to reflect the current stack and all Expo/RN artifacts removed.",
      "acceptanceCriteria": [
        ".env.example uses VITE_* prefix instead of EXPO_PUBLIC_*",
        "Delete eslint.config.mjs (Biome is the only linter)",
        "Delete .coveralls.yml (unused)",
        "Delete expo-env.d.ts (Expo vestige)",
        "Delete .eas/ directory (Expo vestige)",
        "Delete src/stubs/react-native-assets-registry.ts (RN vestige)",
        "Update scripts/setup.sh to reference Capacitor/Vite commands instead of Expo",
        "pnpm typecheck passes",
        "pnpm lint passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Merged to main. .env.example uses VITE_*, eslint.config.mjs/.coveralls.yml/expo-env.d.ts/.eas/ deleted, setup.sh updated.",
      "dependsOn": []
    },
    {
      "id": "US-018",
      "title": "Update Biome, SonarCloud, and TypeScript configs for all packages",
      "description": "As a developer, I want Biome, SonarCloud, and TypeScript to analyze all packages, not just src/.",
      "acceptanceCriteria": [
        "biome.json removes !**/packages exclusion so packages are linted",
        "sonar-project.properties sonar.sources includes all package source directories and removes eslint-report.json reference",
        "tsconfig.json includes all active packages (remove stale excludes)",
        "capacitor.config.ts includes plugin configuration for secure-storage, filesystem, biometric-auth",
        "pnpm lint checks all packages and passes (fix any new lint errors)",
        "pnpm typecheck checks all packages and passes",
        "pnpm test passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Merged to main. biome.json includes packages, sonar-project.properties updated, tsconfig expanded, capacitor plugins configured.",
      "dependsOn": ["US-001", "US-017"]
    },
    {
      "id": "US-019",
      "title": "Remove dead type system (src/types/)",
      "description": "As a developer, I want to eliminate the unused src/types/ directory since all types come from packages.",
      "acceptanceCriteria": [
        "Audit each file in src/types/ -- migrate any type ONLY defined there to the correct package first",
        "Delete entire src/types/ directory (10 files, ~400 lines, zero imports)",
        "Verify no build or typecheck errors after deletion",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-001", "US-007"]
    },
    {
      "id": "US-020",
      "title": "Remove dead exports, unused components, and cleanup debris",
      "description": "As a developer, I want dead exports removed and post-migration debris cleaned up.",
      "acceptanceCriteria": [
        "Remove 15 unused icon presets from src/components/icons/icon-presets.tsx",
        "Remove src/pages/placeholder.tsx (never imported)",
        "Remove empty src/components/workspace/index.ts (exports nothing)",
        "For each orphaned component (BottomSheet, Pagination, Spacer, Tooltip): wire into a page or delete",
        "Remove react-native peer deps from packages/core/package.json and packages/config/package.json",
        "Remove @react-native-async-storage/async-storage from packages/state/ (replace with web-compatible alternative)",
        "Delete or .gitignore archive/*.zip binary files and ralph/ directory (old migration artifacts)",
        "Rename src/hooks/useAppRouter.ts to use-app-router.ts for naming consistency",
        "Replace console.error calls in src/ production files with logger utility from src/lib/logger.ts",
        "pnpm typecheck passes",
        "pnpm lint passes",
        "pnpm test passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-019"]
    },
    {
      "id": "US-021",
      "title": "Add unit tests for all tab pages",
      "description": "As a developer, I want the 5 tab pages (home, projects, agents, chat, settings) to have unit tests since they currently have 0% coverage.",
      "acceptanceCriteria": [
        "src/pages/tabs/home.tsx has tests covering render, data display, navigation",
        "src/pages/tabs/projects.tsx has tests covering project list, empty state, project selection",
        "src/pages/tabs/agents.tsx has tests covering agent list, status display, agent selection",
        "src/pages/tabs/chat.tsx has tests covering thread list, message display, agent selection, message sending",
        "src/pages/tabs/settings.tsx has tests covering settings list, navigation to sub-pages",
        "Each test file has at least 3 test cases covering core functionality",
        "Statement coverage for these files is above 70%",
        "pnpm test passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-008", "US-012"]
    },
    {
      "id": "US-022",
      "title": "Add unit tests for settings and detail pages",
      "description": "As a developer, I want settings pages and remaining detail pages to have unit tests.",
      "acceptanceCriteria": [
        "src/pages/settings/AgentSettings.tsx has tests covering render, interactions, error states",
        "src/pages/settings/CredentialSettings.tsx has tests",
        "src/pages/settings/EditorSettings.tsx has tests",
        "src/pages/detail/AgentDetail.tsx has tests",
        "src/pages/onboarding/complete.tsx has tests",
        "src/layouts/RootLayout.tsx has tests",
        "pnpm test passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-010", "US-011"]
    },
    {
      "id": "US-023",
      "title": "Fix E2E chat crash and restore skipped tests",
      "description": "As a developer, I want the 3 skipped E2E tests to pass so we have full E2E coverage.",
      "acceptanceCriteria": [
        "Investigate root cause of Chat page crashes on web with error boundary in E2E",
        "Fix the crash (likely resolved by US-008 chat refactor)",
        "Remove test.skip from e2e/dashboard.spec.ts:79 (Chat tab navigation)",
        "Remove test.skip from e2e/interactions.spec.ts:65 (Full flow interactions)",
        "Remove test.skip from e2e/interactions.spec.ts:128 (Chat page interactions)",
        "All 3 previously-skipped E2E tests pass",
        "No E2E regressions in existing passing tests",
        "pnpm test passes",
        "pnpm test:e2e:web passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-008"]
    },
    {
      "id": "US-024",
      "title": "Achieve 80%+ statement coverage",
      "description": "As a developer, I want overall test coverage to reach 80% statements (currently 59%).",
      "acceptanceCriteria": [
        "Overall statement coverage >= 80% (measured by pnpm test:coverage)",
        "Overall branch coverage >= 60%",
        "No source file in src/ has 0% coverage",
        "All packages/ have test files (currently packages/types/ has none)",
        "Coverage report is generated correctly",
        "pnpm test passes",
        "pnpm test:coverage passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "",
      "dependsOn": ["US-021", "US-022", "US-023"]
    }
  ],
  "metadata": {
    "updatedAt": "2026-02-23T22:50:00.000Z",
    "completedStories": 9,
    "totalStories": 24,
    "lastVerifiedOn": "main @ 950 tests passing"
  }
}
